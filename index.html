<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Race Pro Car</title>
    <style>
        body {
            margin: 0; padding: 0; background: #222; color: #fff;
            font-family: 'Arial', sans-serif; overflow: hidden;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }
        #gameContainer {
            position: relative; width: 400px; height: 600px;
            background: #333; border: 4px solid #555; overflow: hidden;
        }
        canvas { display: block; background: #444; }

        /* Overlay UI */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10;
        }
        h1 { color: #f1c40f; text-shadow: 0 0 10px #f1c40f; margin-bottom: 30px; }
        button {
            background: #e74c3c; border: none; color: white; padding: 15px 40px;
            margin: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 200px;
        }
        button:hover { background: #c0392b; }

        /* Settings */
        .settings-panel { text-align: left; background: #444; padding: 20px; border-radius: 10px; }
        label { display: block; margin: 10px 0 5px; font-size: 14px; }
        select { width: 100%; padding: 5px; margin-bottom: 10px; }

        #hud {
            position: absolute; top: 10px; left: 10px; color: #f1c40f;
            font-weight: bold; pointer-events: none; z-index: 5;
        }
    </style>
</head>
<body>

<div id="gameContainer">
    <div id="hud">Score: 0 | FPS: 0</div>
    
    <div id="mainMenu" class="overlay">
        <h1>RACE PRO CAR</h1>
        <button onclick="startGame()">START RACE</button>
        <button onclick="showSettings()">SETTINGS</button>
    </div>

    <div id="settingsMenu" class="overlay" style="display:none;">
        <h2>SETTINGS</h2>
        <div class="settings-panel">
            <label>Graphics Quality:</label>
            <select id="gfx">
                <option value="high">High (Glow Effects)</option>
                <option value="low">Low (Solid Colors)</option>
            </select>
            <label>Target FPS:</label>
            <select id="fpsLimit">
                <option value="30">30 FPS</option>
                <option value="60" selected>60 FPS</option>
                <option value="120">120 FPS</option>
            </select>
        </div>
        <button onclick="hideSettings()">SAVE & BACK</button>
    </div>

    <canvas id="gameCanvas" width="400" height="600"></canvas>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const hud = document.getElementById("hud");
    
    // Game Variables
    let gameActive = false;
    let score = 0;
    let speed = 5;
    let player = { x: 175, y: 500, w: 50, h: 80 };
    let enemies = [];
    let roadStrips = [];
    let lastTime = 0;
    let fps = 0;
    
    // Settings Default
    let settings = { gfx: 'high', fps: 60 };

    function showSettings() {
        document.getElementById("mainMenu").style.display = "none";
        document.getElementById("settingsMenu").style.display = "flex";
    }

    function hideSettings() {
        settings.gfx = document.getElementById("gfx").value;
        settings.fps = parseInt(document.getElementById("fpsLimit").value);
        document.getElementById("settingsMenu").style.display = "none";
        document.getElementById("mainMenu").style.display = "flex";
    }

    function startGame() {
        document.getElementById("mainMenu").style.display = "none";
        gameActive = true;
        score = 0;
        speed = 5;
        enemies = [];
        player.x = 175;
        requestAnimationFrame(gameLoop);
    }

    // Input Handling
    let keys = {};
    window.addEventListener("keydown", e => keys[e.code] = true);
    window.addEventListener("keyup", e => keys[e.code] = false);

    // Touch Input
    window.addEventListener("touchstart", e => {
        let touchX = e.touches[0].clientX;
        if(touchX < window.innerWidth/2) keys['ArrowLeft'] = true;
        else keys['ArrowRight'] = true;
    });
    window.addEventListener("touchend", () => {
        keys['ArrowLeft'] = false;
        keys['ArrowRight'] = false;
    });

    function drawCar(x, y, color, isPlayer) {
        // Body
        ctx.fillStyle = color;
        if(settings.gfx === 'high') {
            ctx.shadowBlur = 10;
            ctx.shadowColor = color;
        }
        ctx.fillRect(x, y, 50, 80);
        ctx.shadowBlur = 0;

        // Windows
        ctx.fillStyle = "#333";
        ctx.fillRect(x+5, y+15, 40, 20); // Front
        ctx.fillRect(x+5, y+50, 40, 10); // Rear

        // Lights
        ctx.fillStyle = isPlayer ? "white" : "red";
        ctx.fillRect(x+5, y, 10, 5);
        ctx.fillRect(x+35, y, 10, 5);
    }

    function gameLoop(timestamp) {
        if(!gameActive) return;

        // FPS Logic
        let deltaTime = timestamp - lastTime;
        if (deltaTime < 1000 / settings.fps) {
            requestAnimationFrame(gameLoop);
            return;
        }
        fps = Math.round(1000 / deltaTime);
        lastTime = timestamp;

        update();
        draw();

        requestAnimationFrame(gameLoop);
    }

    function update() {
        // Player Move
        if(keys['ArrowLeft'] && player.x > 10) player.x -= 7;
        if(keys['ArrowRight'] && player.x < 340) player.x += 7;

        // Spawn Enemies
        if(Math.random() < 0.02) {
            enemies.push({ x: Math.random() * 340, y: -100, w: 50, h: 80, color: '#e74c3c' });
        }

        // Move Enemies
        enemies.forEach((enemy, index) => {
            enemy.y += speed;
            
            // Collision Detection
            if (player.x < enemy.x + enemy.w &&
                player.x + player.w > enemy.x &&
                player.y < enemy.y + enemy.h &&
                player.y + player.h > enemy.y) {
                gameOver();
            }

            // Remove off-screen
            if(enemy.y > 600) {
                enemies.splice(index, 1);
                score++;
                speed += 0.1; // Increase difficulty
            }
        });

        hud.innerText = `Score: ${score} | FPS: ${fps}`;
    }

    function draw() {
        // Road
        ctx.fillStyle = "#444";
        ctx.fillRect(0, 0, 400, 600);

        // Road Lines
        ctx.fillStyle = "white";
        for(let i=0; i<10; i++) {
            ctx.fillRect(195, (i*100 + (score*speed)%100), 10, 50);
        }

        // Draw Player
        drawCar(player.x, player.y, "#3498db", true);

        // Draw Enemies
        enemies.forEach(enemy => {
            drawCar(enemy.x, enemy.y, enemy.color, false);
        });
    }

    function gameOver() {
        gameActive = false;
        alert("CRASH! Your Score: " + score);
        document.getElementById("mainMenu").style.display = "flex";
    }

</script>
</body>
    </html>
